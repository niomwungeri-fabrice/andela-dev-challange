'use strict';var cov_2fadgr4c21=function(){var path="/home/inyenyeri/Downloads/JavaScript/andela-dev-challange/src/controller/User-controller.js",hash="d7c0cbbe80ee0764fe7950e3a42a3b4b601a81d2",Function=function(){}.constructor,global=new Function('return this')(),gcv="__coverage__",coverageData={path:"/home/inyenyeri/Downloads/JavaScript/andela-dev-challange/src/controller/User-controller.js",statementMap:{"0":{start:{line:3,column:0},end:{line:5,column:3}},"1":{start:{line:7,column:14},end:{line:7,column:31}},"2":{start:{line:9,column:15},end:{line:9,column:46}},"3":{start:{line:11,column:9},end:{line:11,column:27}},"4":{start:{line:13,column:10},end:{line:13,column:36}},"5":{start:{line:15,column:24},end:{line:15,column:54}},"6":{start:{line:17,column:25},end:{line:17,column:66}},"7":{start:{line:19,column:10},end:{line:19,column:26}},"8":{start:{line:21,column:11},end:{line:21,column:38}},"9":{start:{line:23,column:12},end:{line:23,column:36}},"10":{start:{line:25,column:13},end:{line:25,column:42}},"11":{start:{line:27,column:39},end:{line:27,column:93}},"12":{start:{line:29,column:12},end:{line:100,column:1}},"13":{start:{line:32,column:20},end:{line:32,column:28}},"14":{start:{line:33,column:16},end:{line:33,column:31}},"15":{start:{line:34,column:19},end:{line:34,column:37}},"16":{start:{line:35,column:20},end:{line:35,column:39}},"17":{start:{line:36,column:19},end:{line:36,column:37}},"18":{start:{line:37,column:19},end:{line:37,column:37}},"19":{start:{line:38,column:19},end:{line:38,column:37}},"20":{start:{line:40,column:18},end:{line:40,column:225}},"21":{start:{line:41,column:4},end:{line:43,column:5}},"22":{start:{line:42,column:6},end:{line:42,column:74}},"23":{start:{line:44,column:4},end:{line:46,column:5}},"24":{start:{line:45,column:6},end:{line:45,column:85}},"25":{start:{line:47,column:4},end:{line:49,column:5}},"26":{start:{line:48,column:6},end:{line:48,column:69}},"27":{start:{line:50,column:22},end:{line:50,column:210}},"28":{start:{line:51,column:4},end:{line:58,column:5}},"29":{start:{line:52,column:17},end:{line:52,column:78}},"30":{start:{line:53,column:17},end:{line:53,column:26}},"31":{start:{line:55,column:6},end:{line:55,column:46}},"32":{start:{line:57,column:6},end:{line:57,column:41}},"33":{start:{line:63,column:4},end:{line:65,column:5}},"34":{start:{line:64,column:6},end:{line:64,column:74}},"35":{start:{line:66,column:4},end:{line:68,column:5}},"36":{start:{line:67,column:6},end:{line:67,column:85}},"37":{start:{line:69,column:15},end:{line:69,column:53}},"38":{start:{line:70,column:4},end:{line:84,column:5}},"39":{start:{line:71,column:18},end:{line:71,column:66}},"40":{start:{line:72,column:17},end:{line:72,column:27}},"41":{start:{line:74,column:6},end:{line:76,column:7}},"42":{start:{line:75,column:8},end:{line:75,column:94}},"43":{start:{line:77,column:6},end:{line:79,column:7}},"44":{start:{line:78,column:8},end:{line:78,column:94}},"45":{start:{line:80,column:18},end:{line:80,column:70}},"46":{start:{line:81,column:6},end:{line:81,column:52}},"47":{start:{line:83,column:6},end:{line:83,column:41}},"48":{start:{line:87,column:22},end:{line:87,column:70}},"49":{start:{line:88,column:4},end:{line:98,column:5}},"50":{start:{line:89,column:18},end:{line:89,column:76}},"51":{start:{line:90,column:17},end:{line:90,column:27}},"52":{start:{line:92,column:6},end:{line:94,column:7}},"53":{start:{line:93,column:8},end:{line:93,column:67}},"54":{start:{line:95,column:6},end:{line:95,column:58}},"55":{start:{line:97,column:6},end:{line:97,column:41}},"56":{start:{line:101,column:0},end:{line:101,column:24}}},fnMap:{"0":{name:"_interopRequireDefault",decl:{start:{line:27,column:9},end:{line:27,column:31}},loc:{start:{line:27,column:37},end:{line:27,column:95}},line:27},"1":{name:"signup",decl:{start:{line:31,column:25},end:{line:31,column:31}},loc:{start:{line:31,column:42},end:{line:59,column:3}},line:31},"2":{name:"login",decl:{start:{line:62,column:24},end:{line:62,column:29}},loc:{start:{line:62,column:40},end:{line:85,column:3}},line:62},"3":{name:"_delete",decl:{start:{line:86,column:25},end:{line:86,column:32}},loc:{start:{line:86,column:43},end:{line:99,column:3}},line:86}},branchMap:{"0":{loc:{start:{line:27,column:46},end:{line:27,column:92}},type:"cond-expr",locations:[{start:{line:27,column:70},end:{line:27,column:73}},{start:{line:27,column:76},end:{line:27,column:92}}],line:27},"1":{loc:{start:{line:27,column:46},end:{line:27,column:67}},type:"binary-expr",locations:[{start:{line:27,column:46},end:{line:27,column:49}},{start:{line:27,column:53},end:{line:27,column:67}}],line:27},"2":{loc:{start:{line:41,column:4},end:{line:43,column:5}},type:"if",locations:[{start:{line:41,column:4},end:{line:43,column:5}},{start:{line:41,column:4},end:{line:43,column:5}}],line:41},"3":{loc:{start:{line:41,column:8},end:{line:41,column:45}},type:"binary-expr",locations:[{start:{line:41,column:8},end:{line:41,column:23}},{start:{line:41,column:27},end:{line:41,column:45}}],line:41},"4":{loc:{start:{line:44,column:4},end:{line:46,column:5}},type:"if",locations:[{start:{line:44,column:4},end:{line:46,column:5}},{start:{line:44,column:4},end:{line:46,column:5}}],line:44},"5":{loc:{start:{line:47,column:4},end:{line:49,column:5}},type:"if",locations:[{start:{line:47,column:4},end:{line:49,column:5}},{start:{line:47,column:4},end:{line:49,column:5}}],line:47},"6":{loc:{start:{line:63,column:4},end:{line:65,column:5}},type:"if",locations:[{start:{line:63,column:4},end:{line:65,column:5}},{start:{line:63,column:4},end:{line:65,column:5}}],line:63},"7":{loc:{start:{line:63,column:8},end:{line:63,column:45}},type:"binary-expr",locations:[{start:{line:63,column:8},end:{line:63,column:23}},{start:{line:63,column:27},end:{line:63,column:45}}],line:63},"8":{loc:{start:{line:66,column:4},end:{line:68,column:5}},type:"if",locations:[{start:{line:66,column:4},end:{line:68,column:5}},{start:{line:66,column:4},end:{line:68,column:5}}],line:66},"9":{loc:{start:{line:74,column:6},end:{line:76,column:7}},type:"if",locations:[{start:{line:74,column:6},end:{line:76,column:7}},{start:{line:74,column:6},end:{line:76,column:7}}],line:74},"10":{loc:{start:{line:77,column:6},end:{line:79,column:7}},type:"if",locations:[{start:{line:77,column:6},end:{line:79,column:7}},{start:{line:77,column:6},end:{line:79,column:7}}],line:77},"11":{loc:{start:{line:92,column:6},end:{line:94,column:7}},type:"if",locations:[{start:{line:92,column:6},end:{line:94,column:7}},{start:{line:92,column:6},end:{line:94,column:7}}],line:92}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0},f:{"0":0,"1":0,"2":0,"3":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184"},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();cov_2fadgr4c21.s[0]++;Object.defineProperty(exports,"__esModule",{value:true});var _moment=(cov_2fadgr4c21.s[1]++,require('moment'));var _moment2=(cov_2fadgr4c21.s[2]++,_interopRequireDefault(_moment));var _v=(cov_2fadgr4c21.s[3]++,require('uuid/v4'));var _v2=(cov_2fadgr4c21.s[4]++,_interopRequireDefault(_v));var _HelperController=(cov_2fadgr4c21.s[5]++,require('./Helper-controller'));var _HelperController2=(cov_2fadgr4c21.s[6]++,_interopRequireDefault(_HelperController));var _db=(cov_2fadgr4c21.s[7]++,require('../db'));var _db2=(cov_2fadgr4c21.s[8]++,_interopRequireDefault(_db));var _user=(cov_2fadgr4c21.s[9]++,require('../model/user'));var _user2=(cov_2fadgr4c21.s[10]++,_interopRequireDefault(_user));function _interopRequireDefault(obj){cov_2fadgr4c21.f[0]++;cov_2fadgr4c21.s[11]++;return(cov_2fadgr4c21.b[1][0]++,obj)&&(cov_2fadgr4c21.b[1][1]++,obj.__esModule)?(cov_2fadgr4c21.b[0][0]++,obj):(cov_2fadgr4c21.b[0][1]++,{default:obj});}var Users=(cov_2fadgr4c21.s[12]++,{// Register a user
signup:async function signup(req,res){cov_2fadgr4c21.f[1]++;var _req$body=(cov_2fadgr4c21.s[13]++,req.body),email=(cov_2fadgr4c21.s[14]++,_req$body.email),username=(cov_2fadgr4c21.s[15]++,_req$body.username),firstName=(cov_2fadgr4c21.s[16]++,_req$body.firstName),lastName=(cov_2fadgr4c21.s[17]++,_req$body.lastName),userRole=(cov_2fadgr4c21.s[18]++,_req$body.userRole),password=(cov_2fadgr4c21.s[19]++,_req$body.password);var newUser=(cov_2fadgr4c21.s[20]++,new _user2.default((0,_v2.default)(),email,username,firstName,lastName,userRole,_HelperController2.default.hashPassword(password),(0,_moment2.default)(new Date()),(0,_moment2.default)(new Date())));cov_2fadgr4c21.s[21]++;if((cov_2fadgr4c21.b[3][0]++,!req.body.email)||(cov_2fadgr4c21.b[3][1]++,!req.body.password)){cov_2fadgr4c21.b[2][0]++;cov_2fadgr4c21.s[22]++;return res.status(400).send({message:'Some values are missing'});}else{cov_2fadgr4c21.b[2][1]++;}cov_2fadgr4c21.s[23]++;if(!_HelperController2.default.isValidEmail(req.body.email)){cov_2fadgr4c21.b[4][0]++;cov_2fadgr4c21.s[24]++;return res.status(400).send({message:'Please enter a valid email address'});}else{cov_2fadgr4c21.b[4][1]++;}cov_2fadgr4c21.s[25]++;if(req.body.routine==='_bt_check_unique'){cov_2fadgr4c21.b[5][0]++;cov_2fadgr4c21.s[26]++;return res.status(400).send({message:'User already exist'});}else{cov_2fadgr4c21.b[5][1]++;}var createQuery=(cov_2fadgr4c21.s[27]++,'INSERT INTO\n      users(id, email, username, first_name, last_name,user_role, password, created_date, modified_date)\n      VALUES($1, $2, $3, $4, $5, $6, $7, $8, $9)\n      returning *');cov_2fadgr4c21.s[28]++;try{var _ref=(cov_2fadgr4c21.s[29]++,await _db2.default.query(createQuery,Object.values(newUser))),rows=(cov_2fadgr4c21.s[30]++,_ref.rows);cov_2fadgr4c21.s[31]++;return res.status(201).send(rows[0].id);}catch(error){cov_2fadgr4c21.s[32]++;return res.status(400).send(error);}},// Login a user
login:async function login(req,res){cov_2fadgr4c21.f[2]++;cov_2fadgr4c21.s[33]++;if((cov_2fadgr4c21.b[7][0]++,!req.body.email)||(cov_2fadgr4c21.b[7][1]++,!req.body.password)){cov_2fadgr4c21.b[6][0]++;cov_2fadgr4c21.s[34]++;return res.status(400).send({message:'Some values are missing'});}else{cov_2fadgr4c21.b[6][1]++;}cov_2fadgr4c21.s[35]++;if(!_HelperController2.default.isValidEmail(req.body.email)){cov_2fadgr4c21.b[8][0]++;cov_2fadgr4c21.s[36]++;return res.status(400).send({message:'Please enter a valid email address'});}else{cov_2fadgr4c21.b[8][1]++;}var text=(cov_2fadgr4c21.s[37]++,'SELECT * FROM users WHERE email = $1');cov_2fadgr4c21.s[38]++;try{var _ref2=(cov_2fadgr4c21.s[39]++,await _db2.default.query(text,[req.body.email])),rows=(cov_2fadgr4c21.s[40]++,_ref2.rows);cov_2fadgr4c21.s[41]++;if(!rows[0]){cov_2fadgr4c21.b[9][0]++;cov_2fadgr4c21.s[42]++;return res.status(400).send({message:'The credentials you provided is incorrect'});}else{cov_2fadgr4c21.b[9][1]++;}cov_2fadgr4c21.s[43]++;if(!_HelperController2.default.comparePassword(rows[0].password,req.body.password)){cov_2fadgr4c21.b[10][0]++;cov_2fadgr4c21.s[44]++;return res.status(400).send({message:'The credentials you provided is incorrect'});}else{cov_2fadgr4c21.b[10][1]++;}var token=(cov_2fadgr4c21.s[45]++,_HelperController2.default.generateToken(rows[0].id));cov_2fadgr4c21.s[46]++;return res.status(200).send({token:token});}catch(error){cov_2fadgr4c21.s[47]++;return res.status(400).send(error);}},delete:async function _delete(req,res){cov_2fadgr4c21.f[3]++;var deleteQuery=(cov_2fadgr4c21.s[48]++,'DELETE FROM users WHERE email = $1 returning *');cov_2fadgr4c21.s[49]++;try{var _ref3=(cov_2fadgr4c21.s[50]++,await _db2.default.query(deleteQuery,[req.params.userId])),rows=(cov_2fadgr4c21.s[51]++,_ref3.rows);cov_2fadgr4c21.s[52]++;if(!rows[0]){cov_2fadgr4c21.b[11][0]++;cov_2fadgr4c21.s[53]++;return res.status(404).send({message:'user not found'});}else{cov_2fadgr4c21.b[11][1]++;}cov_2fadgr4c21.s[54]++;return res.status(204).send({message:'deleted'});}catch(error){cov_2fadgr4c21.s[55]++;return res.status(400).send(error);}}});/* Code modified from a file obtained from https://github.com/olawalejarvis/reflection_app_server */cov_2fadgr4c21.s[56]++;exports.default=Users;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlVzZXItY29udHJvbGxlci5qcyJdLCJuYW1lcyI6WyJVc2VycyIsInNpZ251cCIsInJlcSIsInJlcyIsImJvZHkiLCJlbWFpbCIsInVzZXJuYW1lIiwiZmlyc3ROYW1lIiwibGFzdE5hbWUiLCJ1c2VyUm9sZSIsInBhc3N3b3JkIiwibmV3VXNlciIsIlVzZXIiLCJIZWxwZXIiLCJoYXNoUGFzc3dvcmQiLCJEYXRlIiwic3RhdHVzIiwic2VuZCIsIm1lc3NhZ2UiLCJpc1ZhbGlkRW1haWwiLCJyb3V0aW5lIiwiY3JlYXRlUXVlcnkiLCJkYiIsInF1ZXJ5IiwiT2JqZWN0IiwidmFsdWVzIiwicm93cyIsImlkIiwiZXJyb3IiLCJsb2dpbiIsInRleHQiLCJjb21wYXJlUGFzc3dvcmQiLCJ0b2tlbiIsImdlbmVyYXRlVG9rZW4iLCJkZWxldGUiLCJkZWxldGVRdWVyeSIsInBhcmFtcyIsInVzZXJJZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7Ozs7O0FBRUEsSUFBTUEsUUFBUTtBQUNaO0FBQ01DLFFBRk0sd0JBRUNDLEdBRkQsRUFFTUMsR0FGTixFQUVXO0FBQUEsb0JBR2pCRCxJQUFJRSxJQUhhO0FBQUEsUUFFbkJDLEtBRm1CLGFBRW5CQSxLQUZtQjtBQUFBLFFBRVpDLFFBRlksYUFFWkEsUUFGWTtBQUFBLFFBRUZDLFNBRkUsYUFFRkEsU0FGRTtBQUFBLFFBRVNDLFFBRlQsYUFFU0EsUUFGVDtBQUFBLFFBRW1CQyxRQUZuQixhQUVtQkEsUUFGbkI7QUFBQSxRQUU2QkMsUUFGN0IsYUFFNkJBLFFBRjdCOztBQUlyQixRQUFNQyxVQUFVLElBQUlDLGNBQUosQ0FBUyxrQkFBVCxFQUFtQlAsS0FBbkIsRUFBMEJDLFFBQTFCLEVBQW9DQyxTQUFwQyxFQUErQ0MsUUFBL0MsRUFBeURDLFFBQXpELEVBQ2RJLDJCQUFPQyxZQUFQLENBQW9CSixRQUFwQixDQURjLEVBQ2lCLHNCQUFPLElBQUlLLElBQUos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QUNELEtBVkQsQ0FVRSxPQUFPSixLQUFQLEVBQWM7QUFDZCxhQUFPekIsSUFBSWEsTUFBSixDQUFXLEdBQVgsRUFBZ0JDLElBQWhCLENBQXFCVyxLQUFyQixDQUFQO0FBQ0Q7QUFDRixHQWxEVztBQW1ETk0sUUFuRE0seUJBbURDaEMsR0FuREQsRUFtRE1DLEdBbkROLEVBbURXO0FBQ3JCLFFBQU1nQyxjQUFjLGdEQUFwQjtBQUNBLFFBQUk7QUFBQSxrQkFDZSxNQUFNYixhQUFHQyxLQUFILENBQVNZLFdBQVQsRUFBc0IsQ0FBQ2pDLElBQUlrQyxNQUFKLENBQVdDLE1BQVosQ0FBdEIsQ0FEckI7QUFBQSxVQUNNWCxJQUROLFNBQ01BLElBRE47O0FBRUYsVUFBSSxDQUFDQSxLQUFLLENBQUwsQ0FBTCxFQUFjO0FBQ1osZUFBT3ZCLElBQUlhLE1BQUosQ0FBVyxHQUFYLEVBQWdCQyxJQUFoQixDQUFxQixFQUFFQyxTQUFTLGdCQUFYLEVBQXJCLENBQVA7QUFDRDtBQUNELGFBQU9mLElBQUlhLE1BQUosQ0FBVyxHQUFYLEVBQWdCQyxJQUFoQixDQUFxQixFQUFFQyxTQUFTLFNBQVgsRUFBckIsQ0FBUDtBQUNELEtBTkQsQ0FNRSxPQUFPVSxLQUFQLEVBQWM7QUFDZCxhQUFPekIsSUFBSWEsTUFBSixDQUFXLEdBQVgsRUFBZ0JDLElBQWhCLENBQXFCVyxLQUFyQixDQUFQO0FBQ0Q7QUFDRjtBQTlEVyxDQUFkLEMsQ0FQQTtrQkF3RWU1QixLIiwiZmlsZSI6IlVzZXItY29udHJvbGxlci5qcyIsInNvdXJjZVJvb3QiOiIvaG9tZS9pbnllbnllcmkvRG93bmxvYWRzL0phdmFTY3JpcHQvYW5kZWxhLWRldi1jaGFsbGFuZ2Uvc3JjL2NvbnRyb2xsZXIiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBDb2RlIG1vZGlmaWVkIGZyb20gYSBmaWxlIG9idGFpbmVkIGZyb20gaHR0cHM6Ly9naXRodWIuY29tL29sYXdhbGVqYXJ2aXMvcmVmbGVjdGlvbl9hcHBfc2VydmVyICovXG5pbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudCc7XG5pbXBvcnQgdXVpZHY0IGZyb20gJ3V1aWQvdjQnO1xuaW1wb3J0IEhlbHBlciBmcm9tICcuL0hlbHBlci1jb250cm9sbGVyJztcbmltcG9ydCBkYiBmcm9tICcuLi9kYic7XG5pbXBvcnQgVXNlciBmcm9tICcuLi9tb2RlbC91c2VyJztcblxuY29uc3QgVXNlcnMgPSB7XG4gIC8vIFJlZ2lzdGVyIGEgdXNlclxuICBhc3luYyBzaWdudXAocmVxLCByZXMpIHtcbiAgICBjb25zdCB7XG4gICAgICBlbWFpbCwgdXNlcm5hbWUsIGZpcnN0TmFtZSwgbGFzdE5hbWUsIHVzZXJSb2xlLCBwYXNzd29yZCxcbiAgICB9ID0gcmVxLmJvZHk7XG4gICAgY29uc3QgbmV3VXNlciA9IG5ldyBVc2VyKHV1aWR2NCgpLCBlbWFpbCwgdXNlcm5hbWUsIGZpcnN0TmFtZSwgbGFzdE5hbWUsIHVzZXJSb2xlLFxuICAgICAgSGVscGVyLmhhc2hQYXNzd29yZChwYXNzd29yZCksIG1vbWVudChuZXcgRGF0ZSgpKSwgbW9tZW50KG5ldyBEYXRlKCkpKTtcbiAgICBpZiAoIXJlcS5ib2R5LmVtYWlsIHx8ICFyZXEuYm9keS5wYXNzd29yZCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5zZW5kKHsgbWVzc2FnZTogJ1NvbWUgdmFsdWVzIGFyZSBtaXNzaW5nJyB9KTtcbiAgICB9XG4gICAgaWYgKCFIZWxwZXIuaXNWYWxpZEVtYWlsKHJlcS5ib2R5LmVtYWlsKSkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5zZW5kKHsgbWVzc2FnZTogJ1BsZWFzZSBlbnRlciBhIHZhbGlkIGVtYWlsIGFkZHJlc3MnIH0pO1xuICAgIH1cbiAgICBpZiAocmVxLmJvZHkucm91dGluZSA9PT0gJ19idF9jaGVja191bmlxdWUnKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLnNlbmQoeyBtZXNzYWdlOiAnVXNlciBhbHJlYWR5IGV4aXN0JyB9KTtcbiAgICB9XG4gICAgY29uc3QgY3JlYXRlUXVlcnkgPSBgSU5TRVJUIElOVE9cbiAgICAgIHVzZXJzKGlkLCBlbWFpbCwgdXNlcm5hbWUsIGZpcnN0X25hbWUsIGxhc3RfbmFtZSx1c2VyX3JvbGUsIHBhc3N3b3JkLCBjcmVhdGVkX2RhdGUsIG1vZGlmaWVkX2RhdGUpXG4gICAgICBWQUxVRVMoJDEsICQyLCAkMywgJDQsICQ1LCAkNiwgJDcsICQ4LCAkOSlcbiAgICAgIHJldHVybmluZyAqYDtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyByb3dzIH0gPSBhd2FpdCBkYi5xdWVyeShjcmVhdGVRdWVyeSwgT2JqZWN0LnZhbHVlcyhuZXdVc2VyKSk7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDEpLnNlbmQocm93c1swXS5pZCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuc2VuZChlcnJvcik7XG4gICAgfVxuICB9LFxuICAvLyBMb2dpbiBhIHVzZXJcbiAgYXN5bmMgbG9naW4ocmVxLCByZXMpIHtcbiAgICBpZiAoIXJlcS5ib2R5LmVtYWlsIHx8ICFyZXEuYm9keS5wYXNzd29yZCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5zZW5kKHsgbWVzc2FnZTogJ1NvbWUgdmFsdWVzIGFyZSBtaXNzaW5nJyB9KTtcbiAgICB9XG4gICAgaWYgKCFIZWxwZXIuaXNWYWxpZEVtYWlsKHJlcS5ib2R5LmVtYWlsKSkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5zZW5kKHsgbWVzc2FnZTogJ1BsZWFzZSBlbnRlciBhIHZhbGlkIGVtYWlsIGFkZHJlc3MnIH0pO1xuICAgIH1cbiAgICBjb25zdCB0ZXh0ID0gJ1NFTEVDVCAqIEZST00gdXNlcnMgV0hFUkUgZW1haWwgPSAkMSc7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgcm93cyB9ID0gYXdhaXQgZGIucXVlcnkodGV4dCwgW3JlcS5ib2R5LmVtYWlsXSk7XG4gICAgICBpZiAoIXJvd3NbMF0pIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5zZW5kKHsgbWVzc2FnZTogJ1RoZSBjcmVkZW50aWFscyB5b3UgcHJvdmlkZWQgaXMgaW5jb3JyZWN0JyB9KTtcbiAgICAgIH1cbiAgICAgIGlmICghSGVscGVyLmNvbXBhcmVQYXNzd29yZChyb3dzWzBdLnBhc3N3b3JkLCByZXEuYm9keS5wYXNzd29yZCkpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5zZW5kKHsgbWVzc2FnZTogJ1RoZSBjcmVkZW50aWFscyB5b3UgcHJvdmlkZWQgaXMgaW5jb3JyZWN0JyB9KTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHRva2VuID0gSGVscGVyLmdlbmVyYXRlVG9rZW4ocm93c1swXS5pZCk7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLnNlbmQoeyB0b2tlbiB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5zZW5kKGVycm9yKTtcbiAgICB9XG4gIH0sXG4gIGFzeW5jIGRlbGV0ZShyZXEsIHJlcykge1xuICAgIGNvbnN0IGRlbGV0ZVF1ZXJ5ID0gJ0RFTEVURSBGUk9NIHVzZXJzIFdIRVJFIGVtYWlsID0gJDEgcmV0dXJuaW5nIConO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IHJvd3MgfSA9IGF3YWl0IGRiLnF1ZXJ5KGRlbGV0ZVF1ZXJ5LCBbcmVxLnBhcmFtcy51c2VySWRdKTtcbiAgICAgIGlmICghcm93c1swXSkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLnNlbmQoeyBtZXNzYWdlOiAndXNlciBub3QgZm91bmQnIH0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjA0KS5zZW5kKHsgbWVzc2FnZTogJ2RlbGV0ZWQnIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLnNlbmQoZXJyb3IpO1xuICAgIH1cbiAgfSxcbn07XG5cbmV4cG9ydCBkZWZhdWx0IFVzZXJzO1xuIl19